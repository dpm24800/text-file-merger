<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Merge Text Files</title>
    <style>
        :root {
            --bg-color: #121212;
            --text-color: #ffffff;
            --card-color: #1e1e1e;
            --accent-color: #ff4d6d;
            --accent-hover: #ff6e8c;
            --dragover-bg: #333;
        }

        body.light {
            --bg-color: #f4f4f4;
            --text-color: #222;
            --card-color: #ffffff;
            --accent-color: #0078d7;
            --accent-hover: #3399ff;
            --dragover-bg: #bbdefb;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            padding: 20px;
            max-width: 700px;
            margin: auto;
            transition: background 0.3s, color 0.3s;
            user-select: none;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        h1 {
            text-align: center;
            font-weight: 600;
            margin-bottom: 0;
        }

        /* Sexy Choose Files Button with Icon */
        .file-label {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 200px;
            height: 50px;
            background: var(--accent-color);
            color: white;
            border-radius: 30px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            user-select: none;
            margin: 10px auto;
        }

        .file-label:hover {
            background: var(--accent-hover);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
        }

        .file-label input {
            display: none;
        }

        /* Drag & Drop Area highlight */
        #dropArea {
            border: 3px dashed var(--accent-color);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
            color: var(--accent-color);
            font-weight: 600;
            transition: background-color 0.3s, color 0.3s;
        }

        #dropArea.dragover {
            background-color: var(--dragover-bg);
            color: white;
        }

        ul {
            list-style: none;
            padding: 0;
            margin: 0;
            background: var(--card-color);
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
            overflow: hidden;
            margin-top: 18px;
        }

        li {
            padding: 12px 15px;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: grab;
            transition: background 0.2s;
        }

        li:last-child {
            border-bottom: none;
        }

        li:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        li.dragging {
            opacity: 0.5;
        }

        .btn {
            margin-top: 15px;
            padding: 12px 20px;
            background: var(--accent-color);
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            display: inline-block;
            text-align: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            user-select: none;
        }

        .btn:hover {
            background: var(--accent-hover);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .theme-toggle {
            background: none;
            border: 2px solid var(--accent-color);
            color: var(--accent-color);
            padding: 6px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            user-select: none;
        }

        .theme-toggle:hover {
            background: var(--accent-color);
            color: white;
        }

        /* small file-name wrap */
        .filename {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 75%;
        }

        .size {
            opacity: 0.7;
            font-size: 12px;
            margin-left: 8px;
            white-space: nowrap;
        }

        /* hint text when empty */
        .hint {
            text-align: center;
            padding: 18px;
            color: rgba(255, 255, 255, 0.6);
        }

        body.light .hint {
            color: rgba(0, 0, 0, 0.6);
        }
    </style>
</head>

<body>
    <div class="top-bar">
        <h1>Merge Text Files</h1>
        <button class="theme-toggle" id="themeBtn" aria-label="Toggle light/dark theme">â˜€ Day Mode</button>
    </div>

    <label for="fileInput" class="file-label" title="Click to choose text files">
        ðŸ“‚ Choose Files
        <input type="file" id="fileInput" multiple accept=".txt,text/plain" />
    </label>

    <div id="dropArea" tabindex="0" aria-label="Drag and drop text files here or use the choose files button">
        Drag & Drop files here or use the "Choose Files" button
    </div>

    <ul id="fileList" aria-live="polite" aria-relevant="additions removals"></ul>

    <button class="btn" id="mergeBtn">Merge & Download</button>

    <script>
        const fileInput = document.getElementById("fileInput");
        const dropArea = document.getElementById("dropArea");
        const fileList = document.getElementById("fileList");
        const themeBtn = document.getElementById("themeBtn");
        const mergeBtn = document.getElementById("mergeBtn");

        let filesArray = [];

        // Night mode default
        document.body.classList.remove("light");
        themeBtn.textContent = "â˜€ Day Mode";

        themeBtn.addEventListener("click", () => {
            document.body.classList.toggle("light");
            themeBtn.textContent = document.body.classList.contains("light") ? "ðŸŒ™ Night Mode" : "â˜€ Day Mode";
        });

        // Add files from file input
        fileInput.addEventListener("change", (e) => {
            addFiles(Array.from(e.target.files));
        });

        // Add files helper (avoid duplicates by name+size)
        function addFiles(newFiles) {
            for (const f of newFiles) {
                if (!filesArray.some(existing => existing.name === f.name && existing.size === f.size)) {
                    filesArray.push(f);
                }
            }
            renderFileList();
        }

        // Drag & drop file upload handlers
        dropArea.addEventListener("dragenter", (e) => {
            e.preventDefault();
            dropArea.classList.add("dragover");
        });
        dropArea.addEventListener("dragover", (e) => {
            e.preventDefault();
            dropArea.classList.add("dragover");
        });
        dropArea.addEventListener("dragleave", (e) => {
            e.preventDefault();
            // Only remove if leaving the dropArea entirely
            if (!dropArea.contains(e.relatedTarget)) {
                dropArea.classList.remove("dragover");
            }
        });
        dropArea.addEventListener("drop", (e) => {
            e.preventDefault();
            dropArea.classList.remove("dragover");
            if (e.dataTransfer.files && e.dataTransfer.files.length > 0) {
                addFiles(Array.from(e.dataTransfer.files));
                e.dataTransfer.clearData();
            }
        });

        function renderFileList() {
            fileList.innerHTML = "";

            if (!filesArray.length) {
                const hint = document.createElement("li");
                hint.className = "hint";
                hint.textContent = 'No files chosen â€” drag & drop files here or click "Choose Files".';
                fileList.appendChild(hint);
                return;
            }

            filesArray.forEach((file) => {
                const li = document.createElement("li");
                li.draggable = true;
                li._file = file;

                const nameSpan = document.createElement("span");
                nameSpan.className = "filename";
                nameSpan.textContent = file.name;

                const sizeSpan = document.createElement("span");
                sizeSpan.className = "size";
                sizeSpan.textContent = formatBytes(file.size);

                li.appendChild(nameSpan);
                li.appendChild(sizeSpan);

                fileList.appendChild(li);
            });

            addDragAndDrop();
        }

        // Drag and drop reordering inside the file list
        function addDragAndDrop() {
            let dragged = null;

            fileList.addEventListener("dragstart", (e) => {
                const li = e.target.closest("li");
                if (!li) return;
                dragged = li;
                li.classList.add("dragging");
            });

            fileList.addEventListener("dragend", (e) => {
                if (dragged) dragged.classList.remove("dragging");
                dragged = null;
            });

            fileList.addEventListener("dragover", (e) => {
                e.preventDefault();
                if (!dragged) return;
                const target = e.target.closest("li");
                if (!target || target === dragged) return;

                const rect = target.getBoundingClientRect();
                const after = (e.clientY - rect.top) > rect.height / 2;

                if (after) {
                    target.after(dragged);
                } else {
                    target.before(dragged);
                }
            });

            fileList.addEventListener("drop", (e) => {
                e.preventDefault();
                updateFileOrder();
            });
        }

        function updateFileOrder() {
            const newOrder = [];
            fileList.querySelectorAll("li").forEach(li => {
                if (li._file) newOrder.push(li._file);
            });
            filesArray = newOrder;
        }

        mergeBtn.addEventListener("click", async () => {
            if (!filesArray.length) {
                alert("Please upload text files first.");
                return;
            }
            let mergedText = "";
            for (const file of filesArray) {
                const text = await file.text();
                mergedText += text + "\n";
            }

            const blob = new Blob([mergedText], { type: "text/plain" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "merged.txt";
            a.click();
            URL.revokeObjectURL(url);
        });

        function formatBytes(bytes) {
            if (bytes === 0) return "0 B";
            const k = 1024;
            const sizes = ["B", "KB", "MB", "GB"];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + " " + sizes[i];
        }
    </script>
</body>

</html>
